---
title: "MIT Missing Semester 연습문제 03 풀이"
lang: "ko"
layout: post
date: 2021-08-12 01:05:43 +0900
categories: [programming,]
tags: [programming,]
---

이번 챕터는 대부분 vim의 기능에 익숙해지는 파트여서, 특별이 해결할 만한 문제가 없었다.
하지만 마지막 심화 문제로 xml파일을 json으로 변환하는 작업이 있었는데,
생각보다 vim의 매크로 기능이 강력하다고 느껴서 여기에도 풀이를 올려본다.

예제 xml 파일은 다음과 같다:
```xml
<people>
    <person>
        <name>Johnny Zhang Jr.</name>
        <email>amyalvarez@cole.com</email>
    </person>
    <person>
        <name>Edward Cook</name>
        <email>dsparks@alvarez-dunn.com</email>
    </person>
    <person>
        <name>Stephen Sweeney</name>
        <email>dlewis@gmail.com</email>
    </person>
...
</people>
```
<br />

이를 json으로 변환하기 위해선, 먼저 가장 첫번째의 `<people>`과 가장 마지막의 `</people>`을 삭제한다. 이를 삭제하기 위해선 `Gdd`와 `ggdd`를 입력하면 된다.

이제부터 매크로를 하나씩 만들어 가면 된다. 가장 먼저 괄호의 텍스트를 json으로 변환하는 과정은 아래와 같다:

<br />
`qef<r"f>s": "<ESC>f<C"<ESC>q`
<br />

매크로를 다음과 같이 해석할 수 있다.

1. 먼저 매크로 등록 `q`를 누르며 시작. 그리고 매크로 이름 `e`를 지정한다.
1. 첫 번째 괄호를 찾기 위해 `f<` 입력
1. 첫 번째 괄호로 커서가 이동이 된 상태에서, `r"`로 괄호를 따옴표로 치환한다.
1. 첫 번째 괄호쌍으로 가기 위해 `f>` 입력
1. 그리고 `s": "`를 눌러 괄호를 치환하고 텍스트 앞에 따옴표를 붙힌다.
1. `<ESC>`키를 눌러 편집 모드에서 나온다. 그리고 동일하게 `f<`로 괄호를 찾은 후,
1. `C"`를 눌러 이후의 요소를 모두 따옴표로 치환한다.
1. `<ESC>`키를 눌러 편집모드에서 나온 뒤, `q`로 매크로 입력 종료.
<br />

이렇게 `<name>`과 `<email>`을 처리할 수 있다. 그 다음 남은 과제는, `<person>`을 변환하는 것이다. `<person>` 내부에 `<name>`과 `<email>` 요소가 들어있기에, 매크로 안에 매크로를 호출해야 한다. 과정은 아래와 같다:

`qpS{<ESC>j@eA,<ESC>j0@ejS},<ESC>q`
<br />

매크로를 다음과 같이 해석할 수 있다.

1. 매크로 이름을 `p`로 지정한다.
1. `<person>` 태그를 `S{`를 눌러 치환한다.
1. 편집모드에서 나온 뒤, 아래로 이동하여 매크로 e를 실행한 후, `A,`로 문장의 끝에 따옴표를 입력.
1. 다시 편집모드에서 나와, 동일한 과정을 반복한다 (그런데 바로 아래로 이동하면 매크로가 꼬일 것 같아서, `0`으로 텍스트의 시작부분으로 가도록 하였다). 다만, 매크로 e를 실행한 뒤, 바로 아래로 내려와서 `</person>`을 `S}`를 눌러 치환을 하면 마무리된다.

이 매크로를 이용하면 `<person>`태그의 한 파트 전체가 json 형태로 변환이 된다. 하지만 이를 반복하여 수행하기 위해선, 해당 매크로가 매크로 수행 후 바로 다음 `<person>`으로 이동할 수 있도록 명령해야 한다.

`qq@pjq`
<br />

이는 즉, 매크로 p를 수행한 후, 아래로 이동하는 매크로 q를 새로 만드는 것이다.

이렇게 매크로가 완성이 된다. 이를 파일이 끝날 때까지 반복하여 수행할 수 있도록, `999@q`를 입력한다.

다만 마지막 항목에 따옴표가 붙게 되는데, 이 부분은 수동으로 제거하고, 글의 서두와 말미에 `[` 와 `]`를 붙이면 json 형식 변환이 완료된다.
<br />
<br />

굉장히 놀라운 매크로의 기능... regex를 대신하여 사용할 수 있을지 기대가 되는 것 같다.
